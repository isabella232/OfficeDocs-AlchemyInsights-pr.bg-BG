---
title: Проблеми при удостоверяване
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: c7e6d96940f8d7052ee4b49b22c0d1d7d5bd5f9277f4a7eff709def1da2e13af
ms.sourcegitcommit: b5f7da89a650d2915dc652449623c78be6247175
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 08/05/2021
ms.locfileid: "54019497"
---
# <a name="authentication-issues"></a>Проблеми при удостоверяване

**Търсите информация за кодовете на грешка на AADSTS, които се връщат от услугата за маркер за защита на Azure Active Directory (Azure AD) (STS)?** Вижте [кодовете на грешка за удостоверяване на Azure AD](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes) за да намерите описания, корекции и някои предложения за заобиколни решения за AADSTS.

Грешките при удостоверяване могат да бъдат резултат от няколко различни проблема, повечето от които генерират грешка 401 или 403. Например следните проблеми могат да доведат до грешки при удостоверяване:

- Неправилни [потоци на придобиване на маркери за достъп](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization) 
- Неправилно конфигурирани [обхвати на разрешения](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent) 
- Липса на [съгласие](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

За да отстраните често срещани грешки при удостоверяване, изпробвайте предоставените по-долу стъпки, които най-добре съответстват на грешката, която получавате. Възможно повече от една стъпки да се отнасят за грешката, която получавате.

**401 Грешка от липса на удостоверяване: Валиден ли е вашият маркер?**

Уверете се, че вашето приложение представя валиден маркер за достъп до Microsoft Graph като част от искането. Тази грешка често означава, че маркерът за достъп може да липсва в заглавката на искането за удостоверяване на HTTP или че маркерът е невалиден или с изтекъл срок. Настоятелно ви препоръчваме да използвате библиотеката за удостоверяване на Microsoft (MSAL) за получаване на маркери за достъп. Освен това тази грешка може да възникне, ако се опитате да използвате маркер за делегиран достъп, предоставен на личен акаунт в Microsoft за достъп до API, който поддържа само работни или учебни акаунти (организационни акаунти).

**403 Грешка от забрана: Избрали ли сте правилния набор разрешения?**

Уверете се, че сте поискали правилния набор разрешения въз основа на API на Microsoft Graph, които извиква вашето приложение. Препоръчителни разрешения с най-малко привилегии се предоставят във всички теми за метод на обръщение към API на Microsoft Graph. Освен това тези разрешения трябва да бъдат дадени на приложението от потребител или администратор. Даването на разрешения обикновено се извършва чрез страница за съгласие или използване на блейд за регистрация на приложения на Azure Portal. От блейда на **Настройки** за приложението щракнете върху **Задължителни разрешения** и след това щракнете върху **Даване на разрешения**. За повече информация вижте:

- [Разрешения на Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference) 
- [Разбиране на разрешенията и съгласието за Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**403 Грешка от забрана: Вашето приложение придобило ли е маркер, който да съответства на избраните разрешения?**

Уверете се, че типовете разрешения, които са поискани или дадени, съответстват на типа маркер за достъп, който вашето приложение придобива. Може да искате и да давате разрешения за приложение, но да използвате маркери за делегиран интерактивен поток на код, а не маркери за поток на клиентски идентификационни данни или да искате и да давате делегирани разрешения, но да използвате маркери за поток на клиентски идентификационни данни, а не маркери за делегиран поток на код.

За повече информация, свързана с придобиването на маркери, вижте:

- [Получаване на достъп от името на потребители и делегирани разрешения](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD v2.0 – поток на код за удостоверяване на OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [Получаване на достъп без потребител (фиктивна услуга) и разрешения за приложения](https://docs.microsoft.com/graph/auth-v2-service) 
- [Azure AD v2.0 – поток за идентификационни данни на клиент на OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**403 Грешка от забрана: Смяна на парола**

В момента няма разрешения за фиктивни разрешения "от услуга за услуга" за разрешения на приложението, които да позволяват смяна на потребителски пароли. Тези API се поддържат само с помощта на интерактивни делегирани потоци код с влязъл администратор. За повече информация вж. [Разрешения на Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference).

**403 Забранено: Потребителят има ли достъп и дали е лицензиран?**

За делегирани потоци код Microsoft Graph оценява дали искането е разрешено въз основа на разрешенията, дадени на приложението, и разрешенията, които има потребителят, които има влезлият потребител. По принцип тази грешка показва, че потребителят не е достатъчно привилегирован, за да изпълни искането, **или** потребителят не е лицензиран за данните, до които се осъществява достъп. Само потребители с необходимите разрешения или лицензи могат успешно да направят искането.

**403 Забранено: Избрали ли сте правилния API на ресурс?**

Услугите на API, като Microsoft Graph, проверяват дали искането *aud* (аудитория) в получения маркер за достъп съответства на стойността, която очаква за себе си, а ако не, възниква грешка "Забранено" 403. Често срещано объркване, което води до тази грешка, е опитът да се използва маркер, придобит за API на Azure ADGraph, API на Outlook или API на SharePoint/OneDrive, за извикване на Microsoft Graph (или обратно). Уверете се, че ресурсът (или обхватът), за който вашето приложение придобива маркер, съответства на API, който приложението извиква.

**400 "Лоша заявка" или 403 "Забранено": Спазва ли потребителят правилата за условен достъп на организацията си?**

Въз основа на правилата за условен достъп (CA) на организацията, възможно е на потребител, който има достъп до ресурси на Microsoft Graph чрез вашето приложение, да бъде поискана допълнителна информация, която не присъства в маркера за достъп, който първоначално е придобило вашето приложение. В този случай вашето приложение получава грешка **400 с *задължително_взаимодействие*** по време на получаването на маркер за достъп или грешка **403 с *недостатъчни_претенции*** при извикване на Microsoft Graph. И в двата случая отговорът на грешката съдържа допълнителна информация, която може да бъде представена на упълномощената крайна точка, за да поиска от потребителя допълнителна информация (като многофакторно удостоверяване или записване на устройство).

За повече информация, свързана с условния достъп, вижте:

- [Справяне с предизвикателствата на условния достъп чрез MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [Указания за разработчици за условен достъп до Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

***Край на поддръжката за Azure Active Directory удостоверяване (ADAL) и Azure AD Graph API (AAD Graph)***

- От 30 юни 2020 г. вече няма да добавяме нови функции към библиотеката за удостоверяване на Azure Active Directory (ADAL) и Azure AD Graph API (AAD Graph). Ще продължим да предоставяме актуализации на техническата поддръжка и защитата, но повече няма да предоставяме актуализации на функции.
- От 30 юни 2022 г. ще прекратим поддръжката за ADAL и AAD Graph и повече няма да предоставяме актуализации на техническата поддръжка и защитата.
    - Приложенията, които използват ADAL в съществуващи версии на операционната система, ще продължат да работят и след този момент, но няма да получават никаква техническа поддръжка и актуализации на защитата.
    - Приложенията, които използват AAD Graph след този период, може вече да не получават отговори от крайната точка на AAD Graph.

**Мигриране на ADAL**

Препоръчваме да актуализирате до [Библиотеката за удостоверяване на Microsoft (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview), в която има най-новите функции и актуализации на защитата. Тази препоръка е в контекста на мигрирането на приложенията от Microsoft към MSAL до крайния срок на поддръжката. Целта на мигрирането на приложенията на Microsoft към MSAL е да се гарантира, че приложенията се възползват от непрекъснатите подобрения в защитата и функциите на MSAL.

- [Прочетете ЧЗВ за ADAL](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [Научете как да мигрирате приложения на базата на платформа](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- Ако имате нужда от помощ, за да разберете кои от вашите приложения използват ADAL, ви препоръчваме да прегледате изходния код на всички приложения и ако е приложимо, да се свържете с независими доставчици на софтуер (ISV) или доставчици на приложения. Поддръжката на Microsoft също може да ви предостави списък с всички приложения на ADAL, които не са на Microsoft, във вашия клиент.

**Мигриране на AAD Graph**

За приложения, които използват AAD Graph, следвайте нашите указания, за да [мигрирате приложенията на Azure AD Graph към Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true).

- [Нашият контролен списък за мигриране ви дава отправна точка](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist). 
- Вашият портал за регистрация на приложения на Azure показва кои приложения използват AAD Graph. Препоръчваме ви да прегледате изходния код на всички приложения и ако е приложимо, да се свържете с доставчици на интернет или приложения. Поддръжката на Microsoft може също да ви предостави информация за цялото използване на AAD Graph във вашия клиент.

 










